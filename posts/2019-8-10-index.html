<!DOCTYPE html><html><head><meta charSet="utf-8"/><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"/><link rel="manifest" href="/site.webmanifest"/><meta name="msapplication-TileColor" content="#da532c"/><meta name="theme-color" content="#ffffff"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title>Playing DOOM as my Math Project</title><meta name="next-head-count" content="9"/><link rel="preload" href="/_next/static/css/9a4b0f5ce79e080b.css" as="style" crossorigin=""/><link rel="stylesheet" href="/_next/static/css/9a4b0f5ce79e080b.css" crossorigin="" data-n-g=""/><link rel="preload" href="/_next/static/css/ee531a15804ab5f0.css" as="style" crossorigin=""/><link rel="stylesheet" href="/_next/static/css/ee531a15804ab5f0.css" crossorigin="" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" crossorigin="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-70f3bcf14ec27c00.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/framework-28fb632452810d26.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/main-145f833db83c1e47.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/pages/_app-76502e455de2e558.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/733-be30f874b9528e73.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/pages/posts/%5Bid%5D-f11c6f829efd1b32.js" defer="" crossorigin=""></script><script src="/_next/static/7JC_0WuBi3hr_o54gUUjc/_buildManifest.js" defer="" crossorigin=""></script><script src="/_next/static/7JC_0WuBi3hr_o54gUUjc/_ssgManifest.js" defer="" crossorigin=""></script></head><body><div id="__next"><main style="top:0;left:0;right:0;bottom:0;position:absolute"><article class="__className_af7b73"><section class="article-header"><section class="article-header-flex-section"><ul class="__className_29b66e article-header-flex" style="width:fit-content"><li><a href="/"><h1 class="__className_29b66e">yourWaifu</h1></a></li></ul><ul class="article-header-flex right-menu"><li><a href="https://github.com/yourWaifu" aria-label="GitHub"><i class="fab fa-github fa-2x"></i></a></li></ul></section><section class="article-header-info"><h1 class="__className_29b66e article-header-title">Playing DOOM as my Math Project</h1><div><p>written on <!-- -->Aug 10, 2019<!-- --> by Hao Qi Wu</p></div></section></section><div class="article"><section class="article-content"><p>In 2017, for my final project in my geometry class, me and my group were tasked to make a game for the class to play that would help everyone in the class to study for the final exam. Most groups went for a game of Kahoot or Jeopardy. But since I have programming skills, I decided to do something else, make a quiz game in DOOM. I never touched the source code for DOOM before or ever made modifications to a game like DOOM, so it was a pretty crazy idea. However, with years of amateur programming experience, I was confident that I could do it.</p>
<a href="https://youtube.com/watch?v=9vK1hGbhh2s">YouTube Link</a>
<p><a href="https://github.com/yourWaifu/quiz-game-doom-mod/releases">Here&#x27;s where you can download it and play it for yourself.</a></p>
<p>As many of you may know, the source code for DOOM is freely available online under the Doom Source License and GNU GPL. Because of this, the DOOM Community has made source ports that were cross-platform, fixed bugs, enhancements, and altered gameplay.</p>
<p>Because this was a group project, people need something to do and I was the only one with the skills do the programming. So we had 2 writers, one for the questions, and one for things like documentation. There was one other person in the team, but I&#x27;ll be honest and say that I completely forgot what he even did in this project. Sorry, Dakota.</p>
<p>First thing, I did to get this project off the ground was to pick a source port to work with. I needed something that was simple and worked on modern machines. I can&#x27;t exactly remember how I chose the source ports, but I chose Chocolate Doom. Which has 666 stars as of the writing of this article but that&#x27;s not important.</p>
<img alt="" loading="lazy" width="563" height="51" decoding="async" data-nimg="1" style="color:transparent" src="/images/2019-8-doom666stars.png"/>
<p>The idea we had was that every time you take damage in the game, you would be presented with a question to answer. The amount  of damage you take would be instead based on whether or not you answered the question correctly.</p>
<p>So, the first thing I needed to do was find the where in the game&#x27;s code was the logic that handles the player taking damage. <code>P_DamageMobj</code> was exactly the function that I was looking for. Next, we needed some way to display the message on to the screen and we needed a way to pause the game. <code>M_StartMessage</code> did both, killing 2 demons with one gunshot.</p>
<p>Ok great, time to display the question. This part is pretty easy. Just store the questions, possible answers, and correct answers. Then have a function that puts the question and answers next to each other and passes them to the start message function.</p>
<img alt="" loading="lazy" width="1280" height="400" decoding="async" data-nimg="1" style="color:transparent" src="/images/2019-8-doom-question.jpg"/>
<p>This was taken on my phone because I used my phone to show off the progress to my teammates and it was easier this way. I did some transformations on the images so that they don&#x27;t look too bad.</p>
<p>Now, we need some way for the question to be answered. Messages with <code>M_StartMessage</code> only checked for a few keys like y, n, and escape. So, I needed to add more keys for it to check for. To do this, I need to find where in DOOM&#x27;s code does it handle inputs for <code>M_StartMessage</code>. <code>M_Responder</code> is the function where it happens, it also seems to be where the game handles all inputs.</p>
<p>Next, to tell the user that they got the correct answer. The game already has a system for telling the user stuff like this. When you put up health, it would tell you in text that you got some health at the top of the screen. The game does this by editing the player&#x27;s <code>message</code> variable.</p>
<img alt="" loading="lazy" width="1280" height="71" decoding="async" data-nimg="1" style="color:transparent" src="/images/2019-8-doom-player-message.jpg"/>
<p>Great, everything is starting to come together.</p>
<p>Many of questions needed a picture to go along with them, so I needed to figure out how the game add and display images. The game uses its own file format but thankfully people in the DOOM community have already figured how to add images to the game for me and I just had to use some premade tools to do this. DOOM stores them in the WAD file that isn&#x27;t part of the game&#x27;s codebase. The WAD file contains level data, images, sound, etc. However, I still need to figure out how to get the Game to display them. I took a look at how the game displays menu elements like the DOOM logo on the main menu.</p>
<pre><code class="language-c">//
// M_DrawMainMenu
//
void M_DrawMainMenu(void)
{
    V_DrawPatchDirect(94, 2,
                      W_CacheLumpName(DEH_String(&quot;M_DOOM&quot;), PU_CACHE));
}
</code></pre>
<p>That&#x27;s where I found <code>V_DrawPatchDirect</code>, it takes in the x, y coordinates for the images, and whatever this cache stuff is about. All I know is that if I change the value <code>&quot;M_DOOM&quot;</code> it changes what image is drawn onto the screen. However, when I go to see my image, I noticed that the image is stretched. In fact, I realized that all the images are squished to fix this.</p>
<img alt="" loading="lazy" width="320" height="200" decoding="async" data-nimg="1" style="color:transparent" src="/images/2019-8-doom-title-raw.png"/>
<p>Here&#x27;s what the image file looks like.</p>
<img alt="" loading="lazy" width="1280" height="960" decoding="async" data-nimg="1" style="color:transparent" src="/images/2019-8-doom-title.jpg"/>
<p>Here&#x27;s what it looks like in-game. Notice how it&#x27;s not as wide as the image file.</p>
<p>Cool, now we need to display an image when the game displays the question. To do this, I found where, in the code, the game displays its messages. That place is the function called <code>M_Drawer</code>, so in there I made it so that it gets the name of the image of the current question and then display it.</p>
<img alt="" loading="lazy" width="1280" height="960" decoding="async" data-nimg="1" style="color:transparent" src="/images/2019-8-doom-mixtape.jpg"/>
<p>Great, more cringe humor.</p>
<img alt="" loading="lazy" width="1280" height="805" decoding="async" data-nimg="1" style="color:transparent" src="/images/2019-8-doom-question2.jpg"/>
<p>in case you were wondering, wrong answer is a placeholder, those were all replaced.</p>
<p>Now, that&#x27;s all the work that I finished. There were other things I tried to get working but ran out of time. I&#x27;m not mad or upset about it, since they weren&#x27;t really all that important. It&#x27;s the thing with deadlines, you are going to have to cut some stuff to finish on time.</p>
<p>The one feature that was cut was some audio that would play when you get the correct answer and when you answered all the questions. I added the audio into the WAD, added to the game&#x27;s list of sound effects, and sound effect number type and used the function <code>S_StartSound</code> to play it but it only worked some of the time. Each sound has a priority value and I couldn&#x27;t figure out how to set that value correctly before the deadline. But, oh well, things happen and it&#x27;s not something I felt strongly about.</p>
<p>I&#x27;ll be honest the code doesn&#x27;t exactly follow all the good standards but it works. <a href="https://github.com/yourWaifu/quiz-game-doom-mod/commit/130f90faac1871c4dd9d47a8f9264ede5fed4bca">Here, take a look at it yourself if you like.</a></p>
<p>The presentation went without any issues. There was one bug that I was afraid I might hit during the presentation. The game starts with replay, the game calls them demos, playing in the background. When the player gets hurt in the replay, displays the question as if you were the one playing and after that, it would be hard to get back to the main menu. I didn&#x27;t have time to fix it but I thankfully speedran through the menus and didn&#x27;t trigger the bug.</p></section></div></article></main><noscript></noscript></div><script id="__NEXT_DATA__" type="application/json" crossorigin="">{"props":{"pageProps":{"postData":{"id":"2019-8-10-index","content":{"compiledSource":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst {useMDXComponents: _provideComponents} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    p: \"p\",\n    a: \"a\",\n    code: \"code\",\n    pre: \"pre\"\n  }, _provideComponents(), props.components), {YouTube, Image} = _components;\n  if (!Image) _missingMdxReference(\"Image\", true);\n  if (!YouTube) _missingMdxReference(\"YouTube\", true);\n  return _jsxs(_Fragment, {\n    children: [_jsx(_components.p, {\n      children: \"In 2017, for my final project in my geometry class, me and my group were tasked to make a game for the class to play that would help everyone in the class to study for the final exam. Most groups went for a game of Kahoot or Jeopardy. But since I have programming skills, I decided to do something else, make a quiz game in DOOM. I never touched the source code for DOOM before or ever made modifications to a game like DOOM, so it was a pretty crazy idea. However, with years of amateur programming experience, I was confident that I could do it.\"\n    }), \"\\n\", _jsx(YouTube, {\n      videoId: \"9vK1hGbhh2s\",\n      opts: {\n        width: '100%',\n        height: 'auto'\n      }\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.a, {\n        href: \"https://github.com/yourWaifu/quiz-game-doom-mod/releases\",\n        children: \"Here's where you can download it and play it for yourself.\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"As many of you may know, the source code for DOOM is freely available online under the Doom Source License and GNU GPL. Because of this, the DOOM Community has made source ports that were cross-platform, fixed bugs, enhancements, and altered gameplay.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Because this was a group project, people need something to do and I was the only one with the skills do the programming. So we had 2 writers, one for the questions, and one for things like documentation. There was one other person in the team, but I'll be honest and say that I completely forgot what he even did in this project. Sorry, Dakota.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"First thing, I did to get this project off the ground was to pick a source port to work with. I needed something that was simple and worked on modern machines. I can't exactly remember how I chose the source ports, but I chose Chocolate Doom. Which has 666 stars as of the writing of this article but that's not important.\"\n    }), \"\\n\", _jsx(Image, {\n      src: \"/images/2019-8-doom666stars.png\",\n      alt: \"\",\n      width: 563,\n      height: 51\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"The idea we had was that every time you take damage in the game, you would be presented with a question to answer. The amount  of damage you take would be instead based on whether or not you answered the question correctly.\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"So, the first thing I needed to do was find the where in the game's code was the logic that handles the player taking damage. \", _jsx(_components.code, {\n        children: \"P_DamageMobj\"\n      }), \" was exactly the function that I was looking for. Next, we needed some way to display the message on to the screen and we needed a way to pause the game. \", _jsx(_components.code, {\n        children: \"M_StartMessage\"\n      }), \" did both, killing 2 demons with one gunshot.\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Ok great, time to display the question. This part is pretty easy. Just store the questions, possible answers, and correct answers. Then have a function that puts the question and answers next to each other and passes them to the start message function.\"\n    }), \"\\n\", _jsx(Image, {\n      src: \"/images/2019-8-doom-question.jpg\",\n      alt: \"\",\n      width: 1280,\n      height: 400\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"This was taken on my phone because I used my phone to show off the progress to my teammates and it was easier this way. I did some transformations on the images so that they don't look too bad.\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Now, we need some way for the question to be answered. Messages with \", _jsx(_components.code, {\n        children: \"M_StartMessage\"\n      }), \" only checked for a few keys like y, n, and escape. So, I needed to add more keys for it to check for. To do this, I need to find where in DOOM's code does it handle inputs for \", _jsx(_components.code, {\n        children: \"M_StartMessage\"\n      }), \". \", _jsx(_components.code, {\n        children: \"M_Responder\"\n      }), \" is the function where it happens, it also seems to be where the game handles all inputs.\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Next, to tell the user that they got the correct answer. The game already has a system for telling the user stuff like this. When you put up health, it would tell you in text that you got some health at the top of the screen. The game does this by editing the player's \", _jsx(_components.code, {\n        children: \"message\"\n      }), \" variable.\"]\n    }), \"\\n\", _jsx(Image, {\n      src: \"/images/2019-8-doom-player-message.jpg\",\n      alt: \"\",\n      width: 1280,\n      height: 71\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Great, everything is starting to come together.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Many of questions needed a picture to go along with them, so I needed to figure out how the game add and display images. The game uses its own file format but thankfully people in the DOOM community have already figured how to add images to the game for me and I just had to use some premade tools to do this. DOOM stores them in the WAD file that isn't part of the game's codebase. The WAD file contains level data, images, sound, etc. However, I still need to figure out how to get the Game to display them. I took a look at how the game displays menu elements like the DOOM logo on the main menu.\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-c\",\n        children: \"//\\r\\n// M_DrawMainMenu\\r\\n//\\r\\nvoid M_DrawMainMenu(void)\\r\\n{\\r\\n    V_DrawPatchDirect(94, 2,\\r\\n                      W_CacheLumpName(DEH_String(\\\"M_DOOM\\\"), PU_CACHE));\\r\\n}\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"That's where I found \", _jsx(_components.code, {\n        children: \"V_DrawPatchDirect\"\n      }), \", it takes in the x, y coordinates for the images, and whatever this cache stuff is about. All I know is that if I change the value \", _jsx(_components.code, {\n        children: \"\\\"M_DOOM\\\"\"\n      }), \" it changes what image is drawn onto the screen. However, when I go to see my image, I noticed that the image is stretched. In fact, I realized that all the images are squished to fix this.\"]\n    }), \"\\n\", _jsx(Image, {\n      src: \"/images/2019-8-doom-title-raw.png\",\n      alt: \"\",\n      width: 320,\n      height: 200\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Here's what the image file looks like.\"\n    }), \"\\n\", _jsx(Image, {\n      src: \"/images/2019-8-doom-title.jpg\",\n      alt: \"\",\n      width: 1280,\n      height: 960\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Here's what it looks like in-game. Notice how it's not as wide as the image file.\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Cool, now we need to display an image when the game displays the question. To do this, I found where, in the code, the game displays its messages. That place is the function called \", _jsx(_components.code, {\n        children: \"M_Drawer\"\n      }), \", so in there I made it so that it gets the name of the image of the current question and then display it.\"]\n    }), \"\\n\", _jsx(Image, {\n      src: \"/images/2019-8-doom-mixtape.jpg\",\n      alt: \"\",\n      width: 1280,\n      height: 960\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Great, more cringe humor.\"\n    }), \"\\n\", _jsx(Image, {\n      src: \"/images/2019-8-doom-question2.jpg\",\n      alt: \"\",\n      width: 1280,\n      height: 805\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"in case you were wondering, wrong answer is a placeholder, those were all replaced.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Now, that's all the work that I finished. There were other things I tried to get working but ran out of time. I'm not mad or upset about it, since they weren't really all that important. It's the thing with deadlines, you are going to have to cut some stuff to finish on time.\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"The one feature that was cut was some audio that would play when you get the correct answer and when you answered all the questions. I added the audio into the WAD, added to the game's list of sound effects, and sound effect number type and used the function \", _jsx(_components.code, {\n        children: \"S_StartSound\"\n      }), \" to play it but it only worked some of the time. Each sound has a priority value and I couldn't figure out how to set that value correctly before the deadline. But, oh well, things happen and it's not something I felt strongly about.\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"I'll be honest the code doesn't exactly follow all the good standards but it works. \", _jsx(_components.a, {\n        href: \"https://github.com/yourWaifu/quiz-game-doom-mod/commit/130f90faac1871c4dd9d47a8f9264ede5fed4bca\",\n        children: \"Here, take a look at it yourself if you like.\"\n      })]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"The presentation went without any issues. There was one bug that I was afraid I might hit during the presentation. The game starts with replay, the game calls them demos, playing in the background. When the player gets hurt in the replay, displays the question as if you were the one playing and after that, it would be hard to get back to the main menu. I didn't have time to fix it but I thankfully speedran through the menus and didn't trigger the bug.\"\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = Object.assign({}, _provideComponents(), props.components);\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\nfunction _missingMdxReference(id, component) {\n  throw new Error(\"Expected \" + (component ? \"component\" : \"object\") + \" `\" + id + \"` to be defined: you likely forgot to import, pass, or provide it.\");\n}\n","frontmatter":{},"scope":{}},"layout":"article","title":"Playing DOOM as my Math Project","description":null,"author":"Hao Qi Wu","date":"Sat Aug 10 2019 22:30:00 GMT+0000 (Coordinated Universal Time)"}},"__N_SSG":true},"page":"/posts/[id]","query":{"id":"2019-8-10-index"},"buildId":"7JC_0WuBi3hr_o54gUUjc","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>