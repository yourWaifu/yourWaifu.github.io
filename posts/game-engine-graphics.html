<!DOCTYPE html><html><head><meta charSet="utf-8"/><link rel="stylesheet" data-href="https://fonts.googleapis.com/css?family=Raleway:300" data-optimized-fonts="true"/><link rel="stylesheet" type="text/css" data-href="https://fonts.googleapis.com/css?family=Open+Sans:400,700" data-optimized-fonts="true"/><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous"/><link rel="stylesheet" type="text/css" href="/style.css" media="screen"/><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"/><link rel="manifest" href="/site.webmanifest"/><meta name="msapplication-TileColor" content="#da532c"/><meta name="theme-color" content="#ffffff"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title>Video Game Graphics - Make a Game Engine</title><meta name="next-head-count" content="13"/><link rel="preload" href="/_next/static/css/1fca6310a650d159c4fa.css" as="style"/><link rel="stylesheet" href="/_next/static/css/1fca6310a650d159c4fa.css" data-n-g=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/webpack-1d8564d2d19a2a5ef479.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework-92300432a1172ef1338b.js" as="script"/><link rel="preload" href="/_next/static/chunks/main-cdc763525a8ea4696302.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-8b8aac030ffb14bf539f.js" as="script"/><link rel="preload" href="/_next/static/chunks/996-bb53b920ae8c58be156e.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/posts/%5Bid%5D-515e2aa21afb2a32e700.js" as="script"/><style data-href="https://fonts.googleapis.com/css?family=Raleway:300">@font-face{font-family:'Raleway';font-style:normal;font-weight:300;src:url(https://fonts.gstatic.com/s/raleway/v22/1Ptxg8zYS_SKggPN4iEgvnHyvveLxVuEorCIPrc.woff) format('woff')}@font-face{font-family:'Raleway';font-style:normal;font-weight:300;src:url(https://fonts.gstatic.com/s/raleway/v22/1Ptxg8zYS_SKggPN4iEgvnHyvveLxVuEorCFPrcVIT9d0c-dYA.woff) format('woff');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Raleway';font-style:normal;font-weight:300;src:url(https://fonts.gstatic.com/s/raleway/v22/1Ptxg8zYS_SKggPN4iEgvnHyvveLxVuEorCMPrcVIT9d0c-dYA.woff) format('woff');unicode-range:U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Raleway';font-style:normal;font-weight:300;src:url(https://fonts.gstatic.com/s/raleway/v22/1Ptxg8zYS_SKggPN4iEgvnHyvveLxVuEorCHPrcVIT9d0c-dYA.woff) format('woff');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Raleway';font-style:normal;font-weight:300;src:url(https://fonts.gstatic.com/s/raleway/v22/1Ptxg8zYS_SKggPN4iEgvnHyvveLxVuEorCGPrcVIT9d0c-dYA.woff) format('woff');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Raleway';font-style:normal;font-weight:300;src:url(https://fonts.gstatic.com/s/raleway/v22/1Ptxg8zYS_SKggPN4iEgvnHyvveLxVuEorCIPrcVIT9d0c8.woff) format('woff');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style><style data-href="https://fonts.googleapis.com/css?family=Open+Sans:400,700">@font-face{font-family:'Open Sans';font-style:normal;font-weight:400;font-stretch:normal;src:url(https://fonts.gstatic.com/s/opensans/v27/memSYaGs126MiZpBA-UvWbX2vVnXBbObj2OVZyOOSr4dVJWUgsjZ0B4gaVQ.woff) format('woff')}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:normal;src:url(https://fonts.gstatic.com/s/opensans/v27/memSYaGs126MiZpBA-UvWbX2vVnXBbObj2OVZyOOSr4dVJWUgsg-1x4gaVQ.woff) format('woff')}@font-face{font-family:'Open Sans';font-style:normal;font-weight:400;font-stretch:100%;src:url(https://fonts.gstatic.com/s/opensans/v27/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSKmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Open Sans';font-style:normal;font-weight:400;font-stretch:100%;src:url(https://fonts.gstatic.com/s/opensans/v27/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSumu0SC55K5gw.woff2) format('woff2');unicode-range:U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Open Sans';font-style:normal;font-weight:400;font-stretch:100%;src:url(https://fonts.gstatic.com/s/opensans/v27/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSOmu0SC55K5gw.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:400;font-stretch:100%;src:url(https://fonts.gstatic.com/s/opensans/v27/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSymu0SC55K5gw.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:400;font-stretch:100%;src:url(https://fonts.gstatic.com/s/opensans/v27/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTS2mu0SC55K5gw.woff2) format('woff2');unicode-range:U+0590-05FF,U+20AA,U+25CC,U+FB1D-FB4F}@font-face{font-family:'Open Sans';font-style:normal;font-weight:400;font-stretch:100%;src:url(https://fonts.gstatic.com/s/opensans/v27/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSCmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Open Sans';font-style:normal;font-weight:400;font-stretch:100%;src:url(https://fonts.gstatic.com/s/opensans/v27/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSGmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:400;font-stretch:100%;src:url(https://fonts.gstatic.com/s/opensans/v27/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTS-mu0SC55I.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;src:url(https://fonts.gstatic.com/s/opensans/v27/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSKmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;src:url(https://fonts.gstatic.com/s/opensans/v27/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSumu0SC55K5gw.woff2) format('woff2');unicode-range:U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;src:url(https://fonts.gstatic.com/s/opensans/v27/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSOmu0SC55K5gw.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;src:url(https://fonts.gstatic.com/s/opensans/v27/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSymu0SC55K5gw.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;src:url(https://fonts.gstatic.com/s/opensans/v27/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTS2mu0SC55K5gw.woff2) format('woff2');unicode-range:U+0590-05FF,U+20AA,U+25CC,U+FB1D-FB4F}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;src:url(https://fonts.gstatic.com/s/opensans/v27/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSCmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;src:url(https://fonts.gstatic.com/s/opensans/v27/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSGmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;src:url(https://fonts.gstatic.com/s/opensans/v27/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTS-mu0SC55I.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style></head><body><div id="__next"><main style="top:0;left:0;right:0;bottom:0;position:absolute"><article><section class="article-header"><section class="article-header-flex-section"><ul class="article-header-flex" style="width:fit-content"><li><a href="/"><h1>yourWaifu</h1></a></li></ul><ul class="article-header-flex right-menu"><li><a href="https://github.com/yourWaifu"><i class="fab fa-github fa-2x"></i></a></li></ul></section><section class="article-header-info"><h1 class="article-header-title">Video Game Graphics - Make a Game Engine</h1><div><p>written on <!-- -->Nov 29, 2021<!-- --> by Hao Qi Wu</p></div></section></section><div class="article"><section class="article-content"><div><p>Welcome to part 1 of making a game engine. In this part, we will be drawing some graphics.</p>
<iframe width="100%" height="333" src="https://www.youtube.com/embed/CHpcG1VSH0E" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
<p>But first, we need to understand today's graphics hardware. Today, we use GPUs, which stands for Graphics Processing Units. These are specialized processors designed for drawing graphics.
<img src="/images/game-engine-graphics/gpu-list.png" alt="">
There's a wide range of these GPUs that have different features and architectures.</p>
<p><img src="/images/game-engine-graphics/1980s-computers.png" alt=""></p>
<p>In the 1980s, there was a smaller range of GPUs available and developers would write code for the hardware that they would support. However, this turned into an issue in 1994. The Lion King Game came out with many drivers for different types of computers. The game has issues with Compaq computers. Causing Disney's support to be flooded with issues with the game, and parents were given a CD with v1.1 that included better support for more hardware.</p>
<p><img src="/images/game-engine-graphics/doom-95.jpg" alt=""></p>
<p>Microsoft recognized this as a limitation of Windows and created DirectX as a solution. The first game using DirectX being Doom 95 with Gabe Newell being the one who started porting the game over to Windows.
<img src="/images/game-engine-graphics/xbox-console.png" alt="">
Microsoft would also develop a custom version of Windows CE for the Sega Dreamcast with DirectX and would later use DirectX to form the basis of Microsoft's Xbox game console.</p>
<div style='position:relative; padding-bottom:calc(56.25% + 44px)'><iframe src='https://gfycat.com/ifr/SparseWhiteBronco' frameborder='0' scrolling='no' width='100%' height='100%' style='position:absolute;top:0;left:0;' allowfullscreen></iframe></div>
<p>In case, you aren't aware, APIs, short for Application Programming Interfaces, give applications a way to interact with something. For example, a game can sent GPU instructions to DirectX and DirectX would translate that into something that the GPU understands. Examples of a graphics API include OpenGL, Vulkan, and DirectX.</p>
<div style='position:relative; padding-bottom:calc(56.25% + 44px)'><iframe src='https://gfycat.com/ifr/ChillyNegativeBunting' frameborder='0' scrolling='no' width='100%' height='100%' style='position:absolute;top:0;left:0;' allowfullscreen></iframe></div>
<p>These APIs are designed with 3D graphics in mind, but the same functionality can be used for 2D graphics. For example, the game above look like it's in 2D, but you can rotate the camera, and in motion, you can see that there's a third dimension.</p>
<p>Many developers don't use these APIs, at least not directly. Game engines like Unity usually handle this for you. However, without a game engine, you can use rendering libraries to handle the different graphics APIs for you.
Examples include BGFX, three.js, and Filament.</p>
<div style='position:relative; padding-bottom:calc(56.25% + 44px)'><iframe src='https://gfycat.com/ifr/PointlessJovialGyrfalcon' frameborder='0' scrolling='no' width='100%' height='100%' style='position:absolute;top:0;left:0;' allowfullscreen></iframe></div>
<p>Triangles are commonly used as the basic building blocks for graphics. Triangles can be connected together to make more complex shapes that we'll call polygon meshes.</p>
<p><img src="/images/game-engine-graphics/Texture_mapping_demonstration_animation.gif" alt="">
You can use images to get smaller details on the surfaces of triangles. This is known as texture mapping. To get this to work, not only do you need the image, but each point or vertex in the polygon mesh needs to be mapped like locations on a treasure map. This map is known as the UV map.</p>
<p><img src="/images/game-engine-graphics/threejs-materials.jpg" alt="">
<a href="https://threejs.org/examples/?#webgl_materials">https://threejs.org/examples/#webgl_materials</a></p>
<p>You may also change how light reacts to a triangle's surface using materials. You can create materials using shaders or code for the GPU is run with numbers or textures as inputs.</p>
<p><img src="/images/game-engine-graphics/threejs-standard-material.jpg" alt="">
<a href="https://threejs.org/examples/#webgl_materials_variations_standard">https://threejs.org/examples/#webgl_materials_variations_standard</a></p>
<p><img src="/images/game-engine-graphics/compass-enlarged.webp" alt=""></p>
<p>As an example, let's recreate the Minecraft compass and spin its needle.</p>
<pre><code class="language-ts">import * as three from 'three';
</code></pre>
<p>First, I chose to use three.js for rendering, TypeScript as the programming language, and WebPack. To set up your tools, you'll need to install node.js, NPM, and the following packages: typescript @types/three webpack webpack-cli webpack-dev-server. You'll then need to set up TypeScript and WebPack, but I personally just used a template I found online.</p>
<pre><code class="language-ts">this.scene = new three.Scene();
this.scene.background = new three.Color("gray");
</code></pre>
<p>Now, create a scene, where we'll place any lights, cameras, and objects. We'll also set the background color to gray. A colored background is useful for when the scene isn't working.</p>
<pre><code class="language-ts">this.camera = new three.PerspectiveCamera(70, window.innerWidth / window.innerHeight, 1, 1000);
this.camera.position.z = 500;
</code></pre>
<p>The scene shouldn't be gray just yet, as a scene needs a camera.</p>
<div style='position:relative; padding-bottom:calc(56.25% + 44px)'><iframe src='https://gfycat.com/ifr/ObviousInsidiousKestrel' frameborder='0' scrolling='no' width='100%' height='100%' style='position:absolute;top:0;left:0;' allowfullscreen></iframe></div>
<p>There are 2 types you can choose from, perspective and orthographic.</p>
<p><img src="/images/game-engine-graphics/20211116174802_1.jpg" alt="">
Perspective projection in Portal 2</p>
<p><img src="/images/game-engine-graphics/IV_area2_back.PNG.png" alt="">
Orthographic projection in Monument Valley</p>
<p>With perspective projection, objects will appear smaller when they are farther away from the camera. Orthographic projection doesn't do this, and instead things will appear the same size no matter the distance away from the camera.</p>
<pre><code class="language-ts">//create the renderer
this.renderer = new three.WebGLRenderer();
this.renderer.setPixelRatio(window.devicePixelRatio);
document.body.appendChild(this.renderer.domElement);

//start animating
this.animate = this.animate.bind(this);
window.requestAnimationFrame(this.animate);
</code></pre>
<pre><code class="language-ts">animate() {
    window.requestAnimationFrame(this.animate);

    this.renderer.render(this.scene, this.camera);
}
</code></pre>
<p>We'll create a loop that'll animate our compass. In the loop, you call the renderer's render function and give it the scene and camera.</p>
<p><img src="/images/game-engine-graphics/gray_1.52.1.jpg" alt="">
Doing this correctly should give you a gray output.</p>
<pre><code class="language-ts">const meshPromise = new Promise&#x3C;three.Mesh>((resolve, reject) => {
    new three.TextureLoader().load('compass.png', (texture) => {
        const geometry = new three.PlaneGeometry(600, 600);
        const material = new three.MeshBasicMaterial( {map: texture } );

        var mesh = new three.Mesh(geometry, material);

        this.scene.add(mesh);
        resolve(mesh);
    })
});
</code></pre>
<p>Now let's load in our mesh. <a href="/images/game-engine-graphics/compass.png">This is the texture file that we'll be using.</a> Loading a texture from a file will take an unknown amount of time, so you'll want to have it done in the background. The geometry and the material also needs to be defined. That'll be a plane, and the material should just output the color of our texture. Create the mesh using the geometry and material and add it to the sense.</p>
<p><img src="/images/game-engine-graphics/load-mesh_1.56.1.jpg" alt="">
You should get a strange looking texture as a result.</p>
<p>This is because the texture is repeated many times on the texture, and it mapped the corners of the tall image to the corners of our square.</p>
<pre><code class="language-ts">texture.repeat.set(1, 1/2);
</code></pre>
<p><img src="/images/game-engine-graphics/half-repeat_1.57.1.jpg" alt=""></p>
<p>To fix this, I set the texture's repeat vector. This allows textures to be repeated many times, but you can use a fraction to zoom in on the texture.</p>
<div style='position:relative; padding-bottom:calc(56.25% + 44px)'><iframe src='https://gfycat.com/ifr/DangerousFoolhardyBadger' frameborder='0' scrolling='no' width='100%' height='100%' style='position:absolute;top:0;left:0;' allowfullscreen></iframe></div>
<pre><code class="language-ts">const frameSize: number = 16/512; // same as 1/32
texture.repeat.set(1, this.frameSize);
</code></pre>
<p>So, on the y-axis, we use 1 over how many times the compass is repeated on the texture.</p>
<p><img src="/images/game-engine-graphics/set-repeat_1.58.1.jpg" alt="">
The result should be a blurry compass.</p>
<p><img src="/images/game-engine-graphics/compass.jpg" alt="">
The compass in Minecraft isn't blurry, it's pixelated.</p>
<pre><code class="language-ts">texture.magFilter = three.NearestFilter;
</code></pre>
<p>To get the same effect, change the magnification filter.</p>
<p><img src="/images/game-engine-graphics/magnification_1.62.1.jpg" alt="">
The magnification handles texture pixels that are bigger or the same size as a pixel on the screen.
<img src="/images/game-engine-graphics/linear-mag_2.15.1.jpg" alt="">
The default is usually linear, which uses an average of the 4 closest pixels on the texture.
<img src="/images/game-engine-graphics/nearest-mag_2.16.1.jpg" alt="">
To get the pixelated effect, we want to use the nearest pixel on the texture.</p>
<p><img src="/images/game-engine-graphics/set-meg-filter_1.66.1.jpg" alt="">
Resulting in a pixelated compass.</p>
<pre><code class="language-ts">material.alphaTest = 0.5;
</code></pre>
<p>Let's also remove the black background around the compass.</p>
<p><img src="/images/game-engine-graphics/color-picker_1.74.1.jpg" alt="">
Each pixel on the compass texture has 4 values, red, green, blue, and alpha. The alpha value goes from 0 for transparent, 1 for opaque, and around 0.5 for translucent.
<img src="/images/game-engine-graphics/opacity_1.67.1.jpg" alt="">
For translucent material, they are given special treatment that lets them blend in with objects that are behind it. However, this blending can be slower to render and for this texture, the alpha values on this texture are either 0 or 1 because of nearest filtering. So, it makes sense for us to use an alpha text instead. Using an alpha test, makes the renderer ignore parts of the material where the alpha value is larger than the alpha test.</p>
<p><img src="/images/game-engine-graphics/alpha-test_1.78.1.jpg" alt="">
Now you should see a compass on a gray background.</p>
<pre><code class="language-ts">this.frameNum += 1;
(mesh.material as three.MeshBasicMaterial)?.map.offset.set(0, 1 - this.frameSize * this.frameNum);
const frameCount = 512/16;
this.frameNum = this.frameNum % frameCount;
</code></pre>
<p>With all that out of the way, let's start animating the compass.
<img src="/images/game-engine-graphics/bottom-frame_2.20.1.jpg" alt="">
If you look at which frame of the compass if being rendered, it's the one at the very bottom of the image.
<img src="/images/game-engine-graphics/0-uv_2.21.1.jpg" alt="">
This is because 0 in our UV map is on the bottom left.</p>
<div style='position:relative; padding-bottom:calc(56.25% + 44px)'><iframe src='https://gfycat.com/ifr/SelfishAgonizingAllensbigearedbat' frameborder='0' scrolling='no' width='100%' height='100%' style='position:absolute;top:0;left:0;' allowfullscreen></iframe></div>
<p>So, using an offset of 1 - 1/32 gives the first frame. The 2nd frame would be 1 - (1/32 * 2). Giving us the formula 1 - (frameSize * frameNum), with frameNum being set to frameNum + 1 every time we render. You might also need to loop the frameNum back to 1, when it gets higher than the number of frames available, to allow for a looping animation and this can be done with % or modulo.</p>
<div style='position:relative; padding-bottom:calc(56.25% + 44px)'><iframe src='https://gfycat.com/ifr/FlimsyGaseousChanticleer' frameborder='0' scrolling='no' width='100%' height='100%' style='position:absolute;top:0;left:0;' allowfullscreen></iframe></div>
<p>And we're done. <a href="https://github.com/yourWaifu/game-engine/blob/16f7d3059797f87ea6351b755cd719f38f48c97f/js/index.ts">Here's the final code.</a></p>
<p>If you have any question, please feel free to do so in the comments. I'll make a part 2 if this content becomes successful and has lots of likes or claps.</p>
</div></section></div></article></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"id":"game-engine-graphics","content":"\u003cp\u003eWelcome to part 1 of making a game engine. In this part, we will be drawing some graphics.\u003c/p\u003e\n\u003ciframe width=\"100%\" height=\"333\" src=\"https://www.youtube.com/embed/CHpcG1VSH0E\" title=\"YouTube video player\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen\u003e\u003c/iframe\u003e\n\u003cp\u003eBut first, we need to understand today's graphics hardware. Today, we use GPUs, which stands for Graphics Processing Units. These are specialized processors designed for drawing graphics.\r\n\u003cimg src=\"/images/game-engine-graphics/gpu-list.png\" alt=\"\"\u003e\r\nThere's a wide range of these GPUs that have different features and architectures.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/game-engine-graphics/1980s-computers.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eIn the 1980s, there was a smaller range of GPUs available and developers would write code for the hardware that they would support. However, this turned into an issue in 1994. The Lion King Game came out with many drivers for different types of computers. The game has issues with Compaq computers. Causing Disney's support to be flooded with issues with the game, and parents were given a CD with v1.1 that included better support for more hardware.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/game-engine-graphics/doom-95.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eMicrosoft recognized this as a limitation of Windows and created DirectX as a solution. The first game using DirectX being Doom 95 with Gabe Newell being the one who started porting the game over to Windows.\r\n\u003cimg src=\"/images/game-engine-graphics/xbox-console.png\" alt=\"\"\u003e\r\nMicrosoft would also develop a custom version of Windows CE for the Sega Dreamcast with DirectX and would later use DirectX to form the basis of Microsoft's Xbox game console.\u003c/p\u003e\n\u003cdiv style='position:relative; padding-bottom:calc(56.25% + 44px)'\u003e\u003ciframe src='https://gfycat.com/ifr/SparseWhiteBronco' frameborder='0' scrolling='no' width='100%' height='100%' style='position:absolute;top:0;left:0;' allowfullscreen\u003e\u003c/iframe\u003e\u003c/div\u003e\n\u003cp\u003eIn case, you aren't aware, APIs, short for Application Programming Interfaces, give applications a way to interact with something. For example, a game can sent GPU instructions to DirectX and DirectX would translate that into something that the GPU understands. Examples of a graphics API include OpenGL, Vulkan, and DirectX.\u003c/p\u003e\n\u003cdiv style='position:relative; padding-bottom:calc(56.25% + 44px)'\u003e\u003ciframe src='https://gfycat.com/ifr/ChillyNegativeBunting' frameborder='0' scrolling='no' width='100%' height='100%' style='position:absolute;top:0;left:0;' allowfullscreen\u003e\u003c/iframe\u003e\u003c/div\u003e\n\u003cp\u003eThese APIs are designed with 3D graphics in mind, but the same functionality can be used for 2D graphics. For example, the game above look like it's in 2D, but you can rotate the camera, and in motion, you can see that there's a third dimension.\u003c/p\u003e\n\u003cp\u003eMany developers don't use these APIs, at least not directly. Game engines like Unity usually handle this for you. However, without a game engine, you can use rendering libraries to handle the different graphics APIs for you.\r\nExamples include BGFX, three.js, and Filament.\u003c/p\u003e\n\u003cdiv style='position:relative; padding-bottom:calc(56.25% + 44px)'\u003e\u003ciframe src='https://gfycat.com/ifr/PointlessJovialGyrfalcon' frameborder='0' scrolling='no' width='100%' height='100%' style='position:absolute;top:0;left:0;' allowfullscreen\u003e\u003c/iframe\u003e\u003c/div\u003e\n\u003cp\u003eTriangles are commonly used as the basic building blocks for graphics. Triangles can be connected together to make more complex shapes that we'll call polygon meshes.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/game-engine-graphics/Texture_mapping_demonstration_animation.gif\" alt=\"\"\u003e\r\nYou can use images to get smaller details on the surfaces of triangles. This is known as texture mapping. To get this to work, not only do you need the image, but each point or vertex in the polygon mesh needs to be mapped like locations on a treasure map. This map is known as the UV map.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/game-engine-graphics/threejs-materials.jpg\" alt=\"\"\u003e\r\n\u003ca href=\"https://threejs.org/examples/?#webgl_materials\"\u003ehttps://threejs.org/examples/#webgl_materials\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eYou may also change how light reacts to a triangle's surface using materials. You can create materials using shaders or code for the GPU is run with numbers or textures as inputs.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/game-engine-graphics/threejs-standard-material.jpg\" alt=\"\"\u003e\r\n\u003ca href=\"https://threejs.org/examples/#webgl_materials_variations_standard\"\u003ehttps://threejs.org/examples/#webgl_materials_variations_standard\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/game-engine-graphics/compass-enlarged.webp\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eAs an example, let's recreate the Minecraft compass and spin its needle.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-ts\"\u003eimport * as three from 'three';\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eFirst, I chose to use three.js for rendering, TypeScript as the programming language, and WebPack. To set up your tools, you'll need to install node.js, NPM, and the following packages: typescript @types/three webpack webpack-cli webpack-dev-server. You'll then need to set up TypeScript and WebPack, but I personally just used a template I found online.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-ts\"\u003ethis.scene = new three.Scene();\r\nthis.scene.background = new three.Color(\"gray\");\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eNow, create a scene, where we'll place any lights, cameras, and objects. We'll also set the background color to gray. A colored background is useful for when the scene isn't working.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-ts\"\u003ethis.camera = new three.PerspectiveCamera(70, window.innerWidth / window.innerHeight, 1, 1000);\r\nthis.camera.position.z = 500;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe scene shouldn't be gray just yet, as a scene needs a camera.\u003c/p\u003e\n\u003cdiv style='position:relative; padding-bottom:calc(56.25% + 44px)'\u003e\u003ciframe src='https://gfycat.com/ifr/ObviousInsidiousKestrel' frameborder='0' scrolling='no' width='100%' height='100%' style='position:absolute;top:0;left:0;' allowfullscreen\u003e\u003c/iframe\u003e\u003c/div\u003e\n\u003cp\u003eThere are 2 types you can choose from, perspective and orthographic.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/game-engine-graphics/20211116174802_1.jpg\" alt=\"\"\u003e\r\nPerspective projection in Portal 2\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/game-engine-graphics/IV_area2_back.PNG.png\" alt=\"\"\u003e\r\nOrthographic projection in Monument Valley\u003c/p\u003e\n\u003cp\u003eWith perspective projection, objects will appear smaller when they are farther away from the camera. Orthographic projection doesn't do this, and instead things will appear the same size no matter the distance away from the camera.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-ts\"\u003e//create the renderer\r\nthis.renderer = new three.WebGLRenderer();\r\nthis.renderer.setPixelRatio(window.devicePixelRatio);\r\ndocument.body.appendChild(this.renderer.domElement);\r\n\r\n//start animating\r\nthis.animate = this.animate.bind(this);\r\nwindow.requestAnimationFrame(this.animate);\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"language-ts\"\u003eanimate() {\r\n    window.requestAnimationFrame(this.animate);\r\n\r\n    this.renderer.render(this.scene, this.camera);\r\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eWe'll create a loop that'll animate our compass. In the loop, you call the renderer's render function and give it the scene and camera.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/game-engine-graphics/gray_1.52.1.jpg\" alt=\"\"\u003e\r\nDoing this correctly should give you a gray output.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-ts\"\u003econst meshPromise = new Promise\u0026#x3C;three.Mesh\u003e((resolve, reject) =\u003e {\r\n    new three.TextureLoader().load('compass.png', (texture) =\u003e {\r\n        const geometry = new three.PlaneGeometry(600, 600);\r\n        const material = new three.MeshBasicMaterial( {map: texture } );\r\n\r\n        var mesh = new three.Mesh(geometry, material);\r\n\r\n        this.scene.add(mesh);\r\n        resolve(mesh);\r\n    })\r\n});\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eNow let's load in our mesh. \u003ca href=\"/images/game-engine-graphics/compass.png\"\u003eThis is the texture file that we'll be using.\u003c/a\u003e Loading a texture from a file will take an unknown amount of time, so you'll want to have it done in the background. The geometry and the material also needs to be defined. That'll be a plane, and the material should just output the color of our texture. Create the mesh using the geometry and material and add it to the sense.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/game-engine-graphics/load-mesh_1.56.1.jpg\" alt=\"\"\u003e\r\nYou should get a strange looking texture as a result.\u003c/p\u003e\n\u003cp\u003eThis is because the texture is repeated many times on the texture, and it mapped the corners of the tall image to the corners of our square.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-ts\"\u003etexture.repeat.set(1, 1/2);\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cimg src=\"/images/game-engine-graphics/half-repeat_1.57.1.jpg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eTo fix this, I set the texture's repeat vector. This allows textures to be repeated many times, but you can use a fraction to zoom in on the texture.\u003c/p\u003e\n\u003cdiv style='position:relative; padding-bottom:calc(56.25% + 44px)'\u003e\u003ciframe src='https://gfycat.com/ifr/DangerousFoolhardyBadger' frameborder='0' scrolling='no' width='100%' height='100%' style='position:absolute;top:0;left:0;' allowfullscreen\u003e\u003c/iframe\u003e\u003c/div\u003e\n\u003cpre\u003e\u003ccode class=\"language-ts\"\u003econst frameSize: number = 16/512; // same as 1/32\r\ntexture.repeat.set(1, this.frameSize);\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eSo, on the y-axis, we use 1 over how many times the compass is repeated on the texture.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/game-engine-graphics/set-repeat_1.58.1.jpg\" alt=\"\"\u003e\r\nThe result should be a blurry compass.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/game-engine-graphics/compass.jpg\" alt=\"\"\u003e\r\nThe compass in Minecraft isn't blurry, it's pixelated.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-ts\"\u003etexture.magFilter = three.NearestFilter;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eTo get the same effect, change the magnification filter.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/game-engine-graphics/magnification_1.62.1.jpg\" alt=\"\"\u003e\r\nThe magnification handles texture pixels that are bigger or the same size as a pixel on the screen.\r\n\u003cimg src=\"/images/game-engine-graphics/linear-mag_2.15.1.jpg\" alt=\"\"\u003e\r\nThe default is usually linear, which uses an average of the 4 closest pixels on the texture.\r\n\u003cimg src=\"/images/game-engine-graphics/nearest-mag_2.16.1.jpg\" alt=\"\"\u003e\r\nTo get the pixelated effect, we want to use the nearest pixel on the texture.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/game-engine-graphics/set-meg-filter_1.66.1.jpg\" alt=\"\"\u003e\r\nResulting in a pixelated compass.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-ts\"\u003ematerial.alphaTest = 0.5;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eLet's also remove the black background around the compass.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/game-engine-graphics/color-picker_1.74.1.jpg\" alt=\"\"\u003e\r\nEach pixel on the compass texture has 4 values, red, green, blue, and alpha. The alpha value goes from 0 for transparent, 1 for opaque, and around 0.5 for translucent.\r\n\u003cimg src=\"/images/game-engine-graphics/opacity_1.67.1.jpg\" alt=\"\"\u003e\r\nFor translucent material, they are given special treatment that lets them blend in with objects that are behind it. However, this blending can be slower to render and for this texture, the alpha values on this texture are either 0 or 1 because of nearest filtering. So, it makes sense for us to use an alpha text instead. Using an alpha test, makes the renderer ignore parts of the material where the alpha value is larger than the alpha test.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/game-engine-graphics/alpha-test_1.78.1.jpg\" alt=\"\"\u003e\r\nNow you should see a compass on a gray background.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-ts\"\u003ethis.frameNum += 1;\r\n(mesh.material as three.MeshBasicMaterial)?.map.offset.set(0, 1 - this.frameSize * this.frameNum);\r\nconst frameCount = 512/16;\r\nthis.frameNum = this.frameNum % frameCount;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eWith all that out of the way, let's start animating the compass.\r\n\u003cimg src=\"/images/game-engine-graphics/bottom-frame_2.20.1.jpg\" alt=\"\"\u003e\r\nIf you look at which frame of the compass if being rendered, it's the one at the very bottom of the image.\r\n\u003cimg src=\"/images/game-engine-graphics/0-uv_2.21.1.jpg\" alt=\"\"\u003e\r\nThis is because 0 in our UV map is on the bottom left.\u003c/p\u003e\n\u003cdiv style='position:relative; padding-bottom:calc(56.25% + 44px)'\u003e\u003ciframe src='https://gfycat.com/ifr/SelfishAgonizingAllensbigearedbat' frameborder='0' scrolling='no' width='100%' height='100%' style='position:absolute;top:0;left:0;' allowfullscreen\u003e\u003c/iframe\u003e\u003c/div\u003e\n\u003cp\u003eSo, using an offset of 1 - 1/32 gives the first frame. The 2nd frame would be 1 - (1/32 * 2). Giving us the formula 1 - (frameSize * frameNum), with frameNum being set to frameNum + 1 every time we render. You might also need to loop the frameNum back to 1, when it gets higher than the number of frames available, to allow for a looping animation and this can be done with % or modulo.\u003c/p\u003e\n\u003cdiv style='position:relative; padding-bottom:calc(56.25% + 44px)'\u003e\u003ciframe src='https://gfycat.com/ifr/FlimsyGaseousChanticleer' frameborder='0' scrolling='no' width='100%' height='100%' style='position:absolute;top:0;left:0;' allowfullscreen\u003e\u003c/iframe\u003e\u003c/div\u003e\n\u003cp\u003eAnd we're done. \u003ca href=\"https://github.com/yourWaifu/game-engine/blob/16f7d3059797f87ea6351b755cd719f38f48c97f/js/index.ts\"\u003eHere's the final code.\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eIf you have any question, please feel free to do so in the comments. I'll make a part 2 if this content becomes successful and has lots of likes or claps.\u003c/p\u003e\n","layout":"article","title":"Video Game Graphics - Make a Game Engine","description":null,"author":"Hao Qi Wu","date":"Mon Nov 29 2021 22:30:00 GMT+0000 (Coordinated Universal Time)"}},"__N_SSG":true},"page":"/posts/[id]","query":{"id":"game-engine-graphics"},"buildId":"yiBDuXvNTC-ZGfV96TpJm","isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-eef578260fd80f8fff94.js"></script><script src="/_next/static/chunks/webpack-1d8564d2d19a2a5ef479.js" async=""></script><script src="/_next/static/chunks/framework-92300432a1172ef1338b.js" async=""></script><script src="/_next/static/chunks/main-cdc763525a8ea4696302.js" async=""></script><script src="/_next/static/chunks/pages/_app-8b8aac030ffb14bf539f.js" async=""></script><script src="/_next/static/chunks/996-bb53b920ae8c58be156e.js" async=""></script><script src="/_next/static/chunks/pages/posts/%5Bid%5D-515e2aa21afb2a32e700.js" async=""></script><script src="/_next/static/yiBDuXvNTC-ZGfV96TpJm/_buildManifest.js" async=""></script><script src="/_next/static/yiBDuXvNTC-ZGfV96TpJm/_ssgManifest.js" async=""></script></body></html>