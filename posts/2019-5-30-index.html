<!DOCTYPE html><html><head><meta charSet="utf-8"/><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"/><link rel="manifest" href="/site.webmanifest"/><meta name="msapplication-TileColor" content="#da532c"/><meta name="theme-color" content="#ffffff"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title>Sleepy Discord Turns 3 Years Old</title><meta name="next-head-count" content="9"/><link rel="preload" href="/_next/static/css/9a4b0f5ce79e080b.css" as="style" crossorigin=""/><link rel="stylesheet" href="/_next/static/css/9a4b0f5ce79e080b.css" crossorigin="" data-n-g=""/><link rel="preload" href="/_next/static/css/ee531a15804ab5f0.css" as="style" crossorigin=""/><link rel="stylesheet" href="/_next/static/css/ee531a15804ab5f0.css" crossorigin="" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" crossorigin="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-70f3bcf14ec27c00.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/framework-28fb632452810d26.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/main-145f833db83c1e47.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/pages/_app-76502e455de2e558.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/733-be30f874b9528e73.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/pages/posts/%5Bid%5D-f11c6f829efd1b32.js" defer="" crossorigin=""></script><script src="/_next/static/7yIdVE5nMXFa3qWG9nzjs/_buildManifest.js" defer="" crossorigin=""></script><script src="/_next/static/7yIdVE5nMXFa3qWG9nzjs/_ssgManifest.js" defer="" crossorigin=""></script></head><body><div id="__next"><main style="top:0;left:0;right:0;bottom:0;position:absolute"><article class="__className_af7b73"><section class="article-header"><section class="article-header-flex-section"><ul class="__className_29b66e article-header-flex" style="width:fit-content"><li><a href="/"><h1 class="__className_29b66e">yourWaifu</h1></a></li></ul><ul class="article-header-flex right-menu"><li><a href="https://github.com/yourWaifu" aria-label="GitHub"><i class="fab fa-github fa-2x"></i></a></li></ul></section><section class="article-header-info"><h1 class="__className_29b66e article-header-title">Sleepy Discord Turns 3 Years Old</h1><div><p>written on <!-- -->May 30, 2019<!-- --> by Hao Qi Wu</p></div></section></section><div class="article"><section class="article-content"><p>Yes, that’s right. It’s been 3 years now. For the first time ever, I’m going to be doing a look back at over one year of progress. Since this project is mostly made by one person, I might go into my own personal life and how it affects the library.</p>
<p>Do, note that most of these changes aren’t in the master branch and are only available in the develop branch.</p>
<h2>Voice</h2>
<p>A bit of over a year ago, voice support was started on the develop branch. To get this working, it required the library to be able to handle more than one WebSockets connection. WebSockets Connections are what Discord uses to send messages to users in real time. The library used to assume that only one WebSockets connection was needed, that connection being used for incoming information for text channels. In order to connect to a voice channel, 2 WebSockets connections are needed. One to get the information needed to start the voice WebSockets connection and the voice WebSockets connection. The interface used to handle WebSockets connection had to be extended so that the library knows which WebSockets connection is being handled.</p>
<p>Voice receive is still being worked on. It’s not documented so support for it might change in the future.</p>
<h2>Switching to CMake</h2>
<p>Since the easily days of the library, MSBuild or Visual Studio’s build system and Make was the only thing that compiled the library. There have been requests to support CMake. I was pretty new to CMake and never used it before, so I didn&#x27;t add support for it. However, during the summer, I had to learn CMake when I was contributing to the Dolphin Emulator.</p>
<p>CMake solves some long-standing issues that would take time to fix in the build script. Mainly with linking and including the library files. Now thanks to CMake, it’s a solved problem.</p>
<h2>JSON Rewrite</h2>
<p>There were a lot of issues with the old way the library parsed and serialized JSON. The old JSON library that was used, used a lot of memory when parsing the complex objects that Discord was sending. Most objects couldn’t be serialized or it was too much effort to implement. So a solution was needed.</p>
<h3>Switching to RapidJSON</h3>
<p>The solution I came up with was to switch to a better JSON library. RapidJSON is fast and uses less memory. However, Sleepy Discord had a lot of code that used the old JSON library and all that code needed to be rewritten. The rewrite was done and in the process, I made writing the logic needed to parse and serialized Discord structures much easier to write thanks to some heavy use of C++ templates.</p>
<h3>Embeds</h3>
<p>One feature that was often requested for sending Embeds. You could send Embeds before but they were hard and complex to do. You were basically writing the code to create the embed as if you weren’t using a library. Now, thanks to the JSON Rewrite, creating embeds can be done by setting values in an object and then passing that object to the sendMessage function. This is thanks to the rewrite making it much simpler for Sleepy Discord’s Discord objects to be serialized into JSON.</p>
<pre><code class="language-cpp">SleepyDiscord::Embed embed;
embed.title = &quot;Hello World!&quot;;
embed.description = &quot;This is an embed.&quot;;
client.sendMessage(channelID, &quot;&quot;, embed);
</code></pre>
<h2>More Advance Version Control</h2>
<p>The library now knows what version is being used. You can know easily at runtime or compile time check the branch, build number, version hash, and if there are any modifications were made to the library.</p>
<p>You can also check the version based on if some features are available.</p>
<pre><code class="language-cpp">//get the branch name
std::string branch = SleepyDiscord::branch;
//check if feature is avaiable at runtime
if(isFeatureAvaiable(&quot;List of Available Features&quot;))
	a = 0; //do stuff
</code></pre>
<h2>Longer uptime</h2>
<p>There was a long-standing infinite reconnect loop bug. It was pretty random and it caused the longest uptime of the library to be only 3 weeks at most. This has now been fixed and now the library can run a bot for months.</p>
<h2>Discord Server</h2>
<p>I’ve been holding back on making a Discord Server. I mostly held back because I didn’t feel like the idea of being a Discord Server admin, but Sharon, the owner of the Aegis.cpp library, made me bite the bullet.</p>
<p><a href="https://discord.gg/5VDrVfK"><img alt="Discord Server" loading="lazy" width="320" height="76" decoding="async" data-nimg="1" style="color:transparent" src="https://discordapp.com/api/guilds/566681036935790615/embed.png?style=banner2"/></a></p>
<h1>Personal Life</h1>
<p>You can skip to <a href="#plans-for-the-future">Plans for the Future</a> if you don&#x27;t care about my personal life.</p>
<h2>Discord Rich Presence for Dolphin</h2>
<p>Earlier I mentioned in the article that I contributed to Dolphin. I made a pull request to add Discord Rich Presence into Dolphin and it was accepted. Dolphin uses CMake to configure their macOS and Linux builds and I needed to make changes to their builds so I had to learn some CMake. This actually benefited Sleepy Discord as written above.</p>
<h2>College</h2>
<p>I finally graduated from High School and I’m now in my first year of college. This effects the library in that I now have less time to spend working on the library because college in my experience requires more study time to pass classes.</p>
<h1>Plans for the Future</h1>
<p>Last year, I promised that I’ll talk about the future of the library. Well, this is it. I was going to write a whole article about until I realized how little it was about plans for the future. Also, for more up to date plans, <a href="https://trello.com/b/x5xsx21a/sleepy-discord-plans">check out my to-do list</a>.</p>
<h2>Async</h2>
<p>This is partially already available in the library but not easy to use. This one feature going to pretty big for a lot of bots. Having the bot block on every request isn’t going to cut it for bots that are on more servers. It’s not good for bots that need to scale up.</p>
<h2>Better Optional Caching</h2>
<p>Right now, the optional cache can easily take up the most memory. Optimizations, like not storing duplicates and adding some limits to the cache, are plans for I will be making the cache use up less memory.</p>
<h2>Auto Generate Docs</h2>
<p>The docs are barely updated. And it&#x27;s an issue, docs are very important to help make the library easier to use. So, I plan on looking into my options on how docs are going to be auto generated instead of having to manually write everything.</p></section></div></article></main><noscript></noscript></div><script id="__NEXT_DATA__" type="application/json" crossorigin="">{"props":{"pageProps":{"postData":{"id":"2019-5-30-index","content":{"compiledSource":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst {useMDXComponents: _provideComponents} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    p: \"p\",\n    h2: \"h2\",\n    h3: \"h3\",\n    pre: \"pre\",\n    code: \"code\",\n    a: \"a\",\n    h1: \"h1\"\n  }, _provideComponents(), props.components), {Image} = _components;\n  if (!Image) _missingMdxReference(\"Image\", true);\n  return _jsxs(_Fragment, {\n    children: [_jsx(_components.p, {\n      children: \"Yes, that’s right. It’s been 3 years now. For the first time ever, I’m going to be doing a look back at over one year of progress. Since this project is mostly made by one person, I might go into my own personal life and how it affects the library.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Do, note that most of these changes aren’t in the master branch and are only available in the develop branch.\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Voice\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"A bit of over a year ago, voice support was started on the develop branch. To get this working, it required the library to be able to handle more than one WebSockets connection. WebSockets Connections are what Discord uses to send messages to users in real time. The library used to assume that only one WebSockets connection was needed, that connection being used for incoming information for text channels. In order to connect to a voice channel, 2 WebSockets connections are needed. One to get the information needed to start the voice WebSockets connection and the voice WebSockets connection. The interface used to handle WebSockets connection had to be extended so that the library knows which WebSockets connection is being handled.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Voice receive is still being worked on. It’s not documented so support for it might change in the future.\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Switching to CMake\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Since the easily days of the library, MSBuild or Visual Studio’s build system and Make was the only thing that compiled the library. There have been requests to support CMake. I was pretty new to CMake and never used it before, so I didn't add support for it. However, during the summer, I had to learn CMake when I was contributing to the Dolphin Emulator.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"CMake solves some long-standing issues that would take time to fix in the build script. Mainly with linking and including the library files. Now thanks to CMake, it’s a solved problem.\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"JSON Rewrite\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"There were a lot of issues with the old way the library parsed and serialized JSON. The old JSON library that was used, used a lot of memory when parsing the complex objects that Discord was sending. Most objects couldn’t be serialized or it was too much effort to implement. So a solution was needed.\"\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"Switching to RapidJSON\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"The solution I came up with was to switch to a better JSON library. RapidJSON is fast and uses less memory. However, Sleepy Discord had a lot of code that used the old JSON library and all that code needed to be rewritten. The rewrite was done and in the process, I made writing the logic needed to parse and serialized Discord structures much easier to write thanks to some heavy use of C++ templates.\"\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"Embeds\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"One feature that was often requested for sending Embeds. You could send Embeds before but they were hard and complex to do. You were basically writing the code to create the embed as if you weren’t using a library. Now, thanks to the JSON Rewrite, creating embeds can be done by setting values in an object and then passing that object to the sendMessage function. This is thanks to the rewrite making it much simpler for Sleepy Discord’s Discord objects to be serialized into JSON.\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-cpp\",\n        children: \"SleepyDiscord::Embed embed;\\r\\nembed.title = \\\"Hello World!\\\";\\r\\nembed.description = \\\"This is an embed.\\\";\\r\\nclient.sendMessage(channelID, \\\"\\\", embed);\\n\"\n      })\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"More Advance Version Control\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"The library now knows what version is being used. You can know easily at runtime or compile time check the branch, build number, version hash, and if there are any modifications were made to the library.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"You can also check the version based on if some features are available.\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-cpp\",\n        children: \"//get the branch name\\r\\nstd::string branch = SleepyDiscord::branch;\\r\\n//check if feature is avaiable at runtime\\r\\nif(isFeatureAvaiable(\\\"List of Available Features\\\"))\\r\\n\\ta = 0; //do stuff\\n\"\n      })\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Longer uptime\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"There was a long-standing infinite reconnect loop bug. It was pretty random and it caused the longest uptime of the library to be only 3 weeks at most. This has now been fixed and now the library can run a bot for months.\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Discord Server\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"I’ve been holding back on making a Discord Server. I mostly held back because I didn’t feel like the idea of being a Discord Server admin, but Sharon, the owner of the Aegis.cpp library, made me bite the bullet.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.a, {\n        href: \"https://discord.gg/5VDrVfK\",\n        children: _jsx(Image, {\n          src: \"https://discordapp.com/api/guilds/566681036935790615/embed.png?style=banner2\",\n          alt: \"Discord Server\",\n          width: 320,\n          height: 76\n        })\n      })\n    }), \"\\n\", _jsx(_components.h1, {\n      children: \"Personal Life\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"You can skip to \", _jsx(_components.a, {\n        href: \"#plans-for-the-future\",\n        children: \"Plans for the Future\"\n      }), \" if you don't care about my personal life.\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Discord Rich Presence for Dolphin\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Earlier I mentioned in the article that I contributed to Dolphin. I made a pull request to add Discord Rich Presence into Dolphin and it was accepted. Dolphin uses CMake to configure their macOS and Linux builds and I needed to make changes to their builds so I had to learn some CMake. This actually benefited Sleepy Discord as written above.\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"College\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"I finally graduated from High School and I’m now in my first year of college. This effects the library in that I now have less time to spend working on the library because college in my experience requires more study time to pass classes.\"\n    }), \"\\n\", _jsx(_components.h1, {\n      children: \"Plans for the Future\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Last year, I promised that I’ll talk about the future of the library. Well, this is it. I was going to write a whole article about until I realized how little it was about plans for the future. Also, for more up to date plans, \", _jsx(_components.a, {\n        href: \"https://trello.com/b/x5xsx21a/sleepy-discord-plans\",\n        children: \"check out my to-do list\"\n      }), \".\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Async\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"This is partially already available in the library but not easy to use. This one feature going to pretty big for a lot of bots. Having the bot block on every request isn’t going to cut it for bots that are on more servers. It’s not good for bots that need to scale up.\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Better Optional Caching\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Right now, the optional cache can easily take up the most memory. Optimizations, like not storing duplicates and adding some limits to the cache, are plans for I will be making the cache use up less memory.\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Auto Generate Docs\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"The docs are barely updated. And it's an issue, docs are very important to help make the library easier to use. So, I plan on looking into my options on how docs are going to be auto generated instead of having to manually write everything.\"\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = Object.assign({}, _provideComponents(), props.components);\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\nfunction _missingMdxReference(id, component) {\n  throw new Error(\"Expected \" + (component ? \"component\" : \"object\") + \" `\" + id + \"` to be defined: you likely forgot to import, pass, or provide it.\");\n}\n","frontmatter":{},"scope":{}},"layout":"article","title":"Sleepy Discord Turns 3 Years Old","description":null,"author":"Sleepy Flower Girl","date":"Thu May 30 2019 22:30:00 GMT+0000 (Coordinated Universal Time)"}},"__N_SSG":true},"page":"/posts/[id]","query":{"id":"2019-5-30-index"},"buildId":"7yIdVE5nMXFa3qWG9nzjs","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>